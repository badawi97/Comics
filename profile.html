<style>
  label {
    display: block;
  }
  .profile-container {
    background-color: #f4f4f4;
    border-radius: 10px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    padding: 30px;
    max-width: 500px;
    margin: auto;
  }
  .profile-img {
    width: 150px;
    height: 150px;
    border-radius: 50%;
    margin: 0 auto 20px;
    display: block;
    object-fit: cover;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  }
  .profile-info {
    margin-bottom: 20px;
  }
  .profile-info label {
    font-weight: bold;
    display: block;
    margin-bottom: 5px;
  }
  .profile-info input {
    width: 100%;
    padding: 10px;
    border-radius: 5px;
    border: 1px solid #ccc;
    box-sizing: border-box;
  }
  .modal {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 1; /* Sit on top */
    padding-top: 100px; /* Location of the box */
    left: 0;
    top: 0;
    width: 100%; /* Full width */
    height: 100%; /* Full height */
    overflow: auto; /* Enable scroll if needed */
    background-color: rgb(0, 0, 0); /* Fallback color */
    background-color: rgba(0, 0, 0, 0.4); /* Black w/ opacity */
  }

  /* Modal Content */
  .modal-content {
    background-color: #fefefe;
    margin: auto;
    padding: 20px;
    border: 1px solid #888;
    width: 60%;
  }

  /* The Close Button */
  .close {
    color: #aaaaaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
  }

  .close:hover,
  .close:focus {
    color: #000;
    text-decoration: none;
    cursor: pointer;
  }
  .modal-content .profile-info input {
    margin-bottom: 10px;
  }
</style>
<div class="profile-container">
  <img
    class="profile-img"
    src="Images/arabic-logo-white-png.png"
    alt="Profile Picture"
  />
  <div class="profile-info">
    <label for="first-name">First Name:</label>
    <input disabled id="fName" type="text" placeholder="First Name" />
  </div>
  <div class="profile-info">
    <label for="last-name">Last Name:</label>
    <input disabled id="lName" type="text" placeholder="Last Name" />
  </div>
  <div class="profile-info">
    <label for="email">Email:</label>
    <input disabled id="email" type="email" placeholder="Email" />
  </div>
  <div class="profile-info">
    <label for="username">Username:</label>
    <input disabled id="username" type="text" placeholder="Username" />
  </div>
  <div class="profile-info">
    <label for="phone">Phone Number:</label>
    <input disabled id="phone" type="tel" placeholder="Phone Number" />
  </div>
  <div class="profile-info">
    <label for="address">Address:</label>
    <input disabled id="address" type="text" placeholder="Address" />
  </div>
  <div class="profile-info">
    <button id="editSaveBtn">Edit</button>
    <button id="changePassword">Change Password</button>
  </div>
</div>
<!-- The Modal -->
<div id="myModal" class="modal">
  <!-- Modal content -->
  <div class="modal-content">
    <span class="close">&times;</span>
    <h2>Change Password</h2>
    <div class="profile-info">
      <input id="oldPassword" type="text" placeholder="old Password" />
      <input id="newPassword" type="text" placeholder="new Password" />
      <input id="confirmPassword" type="text" placeholder="confirm Password" />
    </div>
    <div class="profile-info">
      <!-- <input id="editSaveBtn" type="button" > -->
    </div>
  </div>
</div>
<script>
  // Get the modal
  var modal = document.getElementById("myModal");

  // Get the button that opens the modal
  var changePasswordBtn = document.getElementById("changePassword");
  var editSaveBtn = document.getElementById("editSaveBtn");
  // Get the <span> element that closes the modal
  var span = document.getElementsByClassName("close")[0];
  // When the user clicks the button, open the modal
  changePasswordBtn.onclick = function () {
    modal.style.display = "block";
  };

  // When the user clicks on <span> (x), close the modal
  span.onclick = function () {
    modal.style.display = "none";
  };

  // When the user clicks anywhere outside of the modal, close it
  window.onclick = function (event) {
    if (event.target == modal) {
      modal.style.display = "none";
    }
  };
  var userId = localStorage.getItem("userId");
  // Fetch user data from the server
  fetchProfileDetials();
  async function fetchProfileDetials() {
    const response = await fetch(`Php/profile.php?userId=` + userId);

    const userData = await response.json();
    if (userData.length > 0) {
      const user = userData[0]; // Assuming only one user is fetched
      document.getElementById("fName").value = user.first_name;
      document.getElementById("lName").value = user.last_name;
      document.getElementById("email").value = user.email;
      document.getElementById("username").value = user.username;
      document.getElementById("phone").value = user.phone; // Assuming 'phone' is a field in your user data
      document.getElementById("address").value = user.address;
    }
  }
  editSaveBtn.value = "Edit"
  // Update edit button functionality
  editSaveBtn.onclick = function () {
    if (editSaveBtn.value === "Edit") {
      // Enable input fields for editing
      document.getElementById("fName").disabled = false;
      document.getElementById("lName").disabled = false;
      document.getElementById("email").disabled = false;
      document.getElementById("username").disabled = false;
      document.getElementById("phone").disabled = false;
      document.getElementById("address").disabled = false;
      editSaveBtn.value = "Save";
    } else {
      // Save changes and disable input fields
      // Send updated data to the server for saving
      var formData = new FormData();
      formData.append("id", userId);
      formData.append("firstName", document.getElementById("fName").value);
      formData.append("lastName", document.getElementById("lName").value);
      formData.append("email", document.getElementById("email").value);
      formData.append("username", document.getElementById("username").value);
      formData.append("phone", document.getElementById("phone").value);
      formData.append("address", document.getElementById("address").value);

      fetch("Php/update_profile.php", {
        method: "POST",
        body: formData,
      })
        .then((response) => response.json())
        .then((data) => {
          // Handle the response from the server
          console.log(data);
          if (data.success) {
            // Show success message or handle as needed
            alert("Profile updated successfully");
          } else {
            // Show error message or handle as needed
            alert("Error updating profile");
          }
        })
        .catch((error) => {
          console.error("Error:", error);
        });

      // Disable input fields after sending data to server
      document.getElementById("fName").disabled = true;
      document.getElementById("lName").disabled = true;
      document.getElementById("email").disabled = true;
      document.getElementById("username").disabled = true;
      document.getElementById("phone").disabled = true;
      document.getElementById("address").disabled = true;
      editSaveBtn.textContent = "Edit";
    }
  };
</script>
